<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GitHub Pages Image Uploader</title>
<style>
  body { font-family: Arial; text-align: center; padding: 50px; }
  input, button { margin: 10px; padding: 8px; font-size: 16px; }
  .preview img { max-width: 300px; margin: 10px; border: 1px solid #ddd; }
  input[type=text] { width: 80%; padding: 5px; }
</style>
</head>
<body>
<h2>Drag & Drop Image Upload</h2>
<input type="file" id="fileInput" accept="image/*"><br>
<button onclick="uploadImage()">Upload</button>
<div class="preview" id="preview"></div>

<script>
const repoUser = "kalaiselvan0962";  // your GitHub username
const repoName = "my-images";        // your repo name
const folder = "uploads";            // folder in repo

async function uploadImage() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("Select an image!");

  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64Data = reader.result.split(",")[1];

    // Trigger GitHub workflow
    const res = await fetch(`https://api.github.com/repos/${repoUser}/${repoName}/actions/workflows/upload-image.yml/dispatches`, {
      method: "POST",
      headers: {
        "Accept": "application/vnd.github+json",
        "Authorization": `token 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`
      },
      body: JSON.stringify({
        ref: "main",
        inputs: {
          filename: file.name,
          base64image: base64Data
        }
      })
    });

    if (res.ok) {
      const link = `https://${repoUser}.github.io/${repoName}/${folder}/${file.name}`;
      document.getElementById("preview").innerHTML = `
        <p>Upload triggered! Your image will appear shortly:</p>
        <img src="${link}" alt="Preview">
        <input type="text" value="${link}" readonly onclick="this.select()">
        <p>Note: It may take a few seconds for the workflow to commit and GitHub Pages to update.</p>
      `;
    } else {
      console.log(await res.json());
      alert("Upload failed. Check console for details.");
    }
  };
  reader.readAsDataURL(file);
}
</script>
</body>
</html>
